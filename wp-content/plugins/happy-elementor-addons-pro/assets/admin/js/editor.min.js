"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(i){window.haHasIconLibrary=function(){return elementor.helpers&&elementor.helpers.renderIcon},window.haGetFeatureLabel=function(t){var e=document.createElement("DIV");return e.innerHTML=t,20<(t=e.textContent||e.innerText||t).length?t.substring(0,20)+"...":t},window.haGetTranslated=function(t,e){return elementorCommon.translate(t,null,e,HappyAddonsEditor.i18n)};elementor.hooks.addFilter("element/view",function(t,e){return"widget"===(e=e).get("elType")&&"ha-hotspots"===e.get("widgetType")?t.extend((n=t,{initialize:function(){n.prototype.initialize.apply(this,arguments),this.updateContextMenu(),this.addedByContextMenuData=null,this.listenTo(elementor.channels.dataEditMode,"switch",this.toggleSpotDragMode),this.listenTo(this.model.get("editSettings"),"change:activeItemIndex",this.onEditSettingsChange),this.listenTo(this.model.get("settings").get("spots"),"add",this.handleAddedByContextMenu)},handleAddedByContextMenu:function(t){var e=elementorFrontend.getCurrentDeviceMode(),e="desktop"===e?"":"_"+e,n="x_pos",o="y_pos",i={},a=this.$el.width(),s=this.$el.height(),d=this.addedByContextMenuData&&this.addedByContextMenuData.offsetX,r=this.addedByContextMenuData&&this.addedByContextMenuData.offsetY,l=t.get(n+e).unit,u=t.get(o+e).unit;_.isNull(this.addedByContextMenuData)||(d=(100*d/a).toFixed(2),r=(100*r/s).toFixed(2),i[n+e]={size:d,unit:l},i[o+e]={size:r,unit:u},t.setExternalChange(i),this.renderStyles(),this.addedByContextMenuData=null)},updateContextMenu:function(){var t=this.getBehavior("contextMenu"),e=t.getOption("groups"),n=_.findWhere(e,function(t){return"general"===t.name}),o=_.findIndex(n.actions,function(t){return"ha-add-hotspot"===t.name}),i=this;-1===o&&n.actions.push({name:"ha-add-hotspot",title:"Add Hotspot",icon:"hm hm-happyaddons",callback:function(){i.model.trigger("request:edit"),i.getSpotsView().onButtonAddRowClick()}}),t.options.groups=e,t.initContextMenu()},onEditSettingsChange:function(t){this.$el.find('[data-index="'+(t.get("activeItemIndex")-1)+'"]').addClass("ha-hotspots__item--focus").siblings(".ha-hotspots__item--focus").removeClass("ha-hotspots__item--focus")},getControlViewByName:function(e){return elementor.getPanelView().getCurrentPageView().children.find(function(t){return t.model.get("name")===e})},getSpotsView:function(){return $e.routes.isPartOf("panel/editor/content")||$e.route("panel/editor/content",{model:this.getContainer().model,view:this.getContainer().view}),"_section_spots"!==this.model.get("editSettings").get("panel").activeSection&&this.getControlViewByName("_section_spots").ui.heading.click(),this.getControlViewByName("spots")},getSpotByIndex:function(t){return this.getSpotsView().children.findByIndex(t)},onRender:function(){n.prototype.onRender.call(this);var t=this;_.defer(function(){t.toggleSpotDragMode()})},onDestroy:function(){this.deactivateSpotDragMode(),n.prototype.onDestroy.call(this)},ui:function(){var t;return(t=n.__super__.ui.call(this)).spotHandle="> .elementor-widget-container .ha-hotspots__item",t},events:function(){var t;return(t=n.__super__.events.call(this)).contextmenu="onContextMenuOpen",t["click @ui.spotHandle"]="onClickSpot",t["dragstart @ui.spotHandle"]="openSelectedSpot",t["dragstop @ui.spotHandle"]="onDragSpotHandle",t},onContextMenuOpen:function(t){t.stopPropagation(),this.addedByContextMenuData=t},onClickSpot:function(t){t.preventDefault(),this.openSelectedSpot(t)},openSelectedSpot:function(t){t.stopPropagation(),this.model.trigger("request:edit");t=this.getSpotByIndex(t.currentTarget.getAttribute("data-index")).ui.itemTitle;t.parent().next().hasClass("editable")||t.click()},onDragSpotHandle:function(t,e){t.stopPropagation();var t=elementorFrontend.getCurrentDeviceMode(),t="desktop"===t?"":"_"+t,n=this.getEditModel().getSetting("spots"),o=e.helper,i=o.data("index"),n=n.at(i),i={},a=elementorFrontend.config.is_rtl,s=o.offsetParent().width(),d=o.offsetParent().height(),r=o.outerWidth(!0),l=e.position.left,a=a?s-l-r:l,r=e.position.top,l=n.get("x_pos"+t).unit,e=n.get("y_pos"+t).unit,a=(100*a/s).toFixed(2),r=(100*r/d).toFixed(2),u=(i["x_pos"+t]={size:a,unit:l},i["y_pos"+t]={size:r,unit:e},n.setExternalChange(i),this.renderStyles(),setTimeout(function(){o.css({top:"",left:"",right:"",bottom:"",width:"",height:""}),clearTimeout(u)},250));window.postMessage({action:"hotsopt_updated"})},activateSpotDragMode:function(){this.ui.spotHandle.draggable({addClasses:!1})},deactivateSpotDragMode:function(){this.ui.spotHandle.draggable("instance")&&this.ui.spotHandle.draggable("destroy")},toggleSpotDragMode:function(){var t="edit"===elementor.channels.dataEditMode.request("activeMode");this.deactivateSpotDragMode(),t&&elementor.userCan("design")&&this.activateSpotDragMode()}})):t;var n}),i(window).on("message",function(t){"object"==_typeof(t.originalEvent.data)&&Reflect.has(t.originalEvent.data,"action")&&"hotsopt_updated"==Reflect.get(t.originalEvent.data,"action")&&i('* [data-setting="size"]').first().trigger("input")});elementor.hooks.addAction("panel/open_editor/widget/ha-one-page-nav",function(t,e,n){function o(){setTimeout(function(){i("#elementor-panel-content-wrapper [data-setting=select_design]").trigger("change"),i("#elementor-controls").on("click",".elementor-control-navigation_lists .elementor-repeater-add",function(){i("#elementor-panel-content-wrapper [data-setting=select_design]").trigger("change")})},500)}o(),elementor.channels.editor.on("section:activated",function(t){"_section_navigation"==t&&o()}),i("#elementor-panel-content-wrapper").on("change","[data-setting=select_design]",function(){var t,e,n;t=i(this).val(),e=elementor.panel.$el.find(".ha-opn-design-refactor-default"),n=elementor.panel.$el.find(".ha-opn-design-refactor-others-title"),"ha-opn-design-default"!=t?(e.hide(),"ha-opn-design-magool"==t?n.hide():n.show()):(e.show(),n.show())})})}(jQuery);